# Code Review Feedback: Devices API
# Principal Java Engineer Review

# 1. Project Structure & Configuration
# ----------------------------------
# [CRITICAL] Invalid Spring Boot Version
# The libs.versions.toml file specifies version "4.0.0" for Spring Boot.
# This version does not exist. The latest stable version is likely 3.4.x.
# ACTION: Update to a valid stable version (e.g., "3.4.0").

# 2. Architecture & Design Principles
# -----------------------------------
# [VIOLATION] Layer Separation / Separation of Concerns
# The DeviceService (Business Layer) is coupled to the API Layer.
# It accepts CreateDeviceRequest (DTO) and returns CreateDeviceResponse (DTO).
# This makes the service hard to reuse and tightly coupled to the web interface.
# ACTION: Refactor Service to accept and return 'Device' entities.
#         Move DTO<->Entity mapping logic to the Controller.

# 3. Persistence Layer (Spring Data JPA)
# --------------------------------------
# [PERFORMANCE] Inefficient Entity Refresh
# DeviceService.create() calls flush() and refresh() to get the DB-generated timestamp.
# This forces extra DB roundtrips.
# ACTION: Use Hibernate's @CreationTimestamp on the Entity to populate it in-memory.

# [CLEANUP] Redundant Repository Method
# DeviceRepository has 'getDevicesById(UUID id)'.
# JpaRepository already provides 'findById(UUID id)'.
# ACTION: Remove the redundant method.

# [BOILERPLATE] Entity Class
# Device.java has manual getters, constructors, and equals/hashCode.
# ACTION: Use Lombok (@Getter, @NoArgsConstructor) to reduce noise.

# 4. Spring Best Practices (IoC & DI)
# -----------------------------------
# [BOILERPLATE] Manual Constructor Injection
# DeviceService uses a manually written constructor for injection.
# ACTION: Use Lombok's @RequiredArgsConstructor for cleaner code.

# 5. API Layer (Spring WebMVC)
# ----------------------------
# [DESIGN] Unnecessary Response Validation
# CreateDeviceResponse (DTO) has @NotNull annotations.
# Validation is for INPUT (Requests), not OUTPUT (Responses).
# ACTION: Remove validation annotations from Response DTOs.

# [CLEANUP] Redundant Controller Annotations
# DeviceController uses @Nonnull on parameters.
# @Valid and @RequestBody are sufficient.
# ACTION: Remove @Nonnull.

# 6. Java 21 Features
# -------------------
# [GOOD] Records
# Using 'record' for DTOs is excellent practice. Keep it up.

# [CONSISTENCY] 'var' Usage
# Usage of 'var' is inconsistent (used in getAll, not elsewhere).
# ACTION: Adopt 'var' consistently where the type is obvious (e.g., var device = ...).

# 7. Code Quality & Boilerplate
# -----------------------------
# [BOILERPLATE] Manual Mapper
# DeviceMapper implements mapping logic manually.
# ACTION: Use MapStruct annotations (@Mapping) to auto-generate implementation.

# [DRY] Exception Handler
# GlobalExceptionHandler repeats ProblemDetail construction logic.
# ACTION: Extract common logic to a private helper method.
